<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Will You Be My Valentine? üíù</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Load your app AFTER parsing HTML -->
  <script src="app.js" defer></script>
</head>

<body>
  <div id="bg"></div>

  <main class="card" id="app">
    <h1 id="title">Loading‚Ä¶</h1>
    <p id="subtitle" class="muted"></p>

    <div id="stage" class="stage">
      <!-- injected -->
    </div>

    <div id="controls" class="controls"></div>
  </main>


 <!-- Hidden background music -->
<audio id="bgm" loop preload="auto" playsinline>
  <source src="audio.mp3" type="audio/mpeg" />
</audio>

<div id="musicGate" class="musicGate hidden">
  <button id="musicGateBtn" class="btn">üíñ Tap to start our song</button>
</div>

<script>
  const bgm = document.getElementById("bgm");
  const gate = document.getElementById("musicGate");
  const gateBtn = document.getElementById("musicGateBtn");

  async function startMusic() {
    try {
      bgm.volume = 0.8; // optional
      await bgm.play();
      gate.classList.add("hidden");
      cleanup();
    } catch (e) {
      gate.classList.remove("hidden");
      console.warn("Music blocked or failed:", e);
    }
  }

  function cleanup() {
    window.removeEventListener("pointerdown", startMusic);
    window.removeEventListener("keydown", startMusic);
    window.removeEventListener("touchstart", startMusic);
  }

  // Button always works (user gesture)
  gateBtn.addEventListener("click", startMusic);

  // Best UX: first interaction anywhere starts music
  window.addEventListener("pointerdown", startMusic, { once: true });
  window.addEventListener("touchstart", startMusic, { once: true });
  window.addEventListener("keydown", startMusic, { once: true });

  // IMPORTANT: do NOT call startMusic() automatically on load
</script>
